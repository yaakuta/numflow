/**
 * Step 300: Create Order
 *
 * Create order with validated data.
 * (In production, save to database)
 */

module.exports = async (ctx, req, res) => {
  console.log('ðŸ”¹ Step 300: Create order')

  const { productId, quantity, userId } = ctx.orderData

  // Generate order ID (in production, generated by DB)
  const orderId = `ORD-${Date.now()}-${Math.random().toString(36).substring(7)}`

  // Create order object
  const order = {
    orderId,
    productId,
    quantity,
    userId,
    status: 'pending',
    createdAt: new Date().toISOString(),
    totalAmount: quantity * 10000, // Fixed price (in production, get from product info)
  }

  console.log('  âœ… Order creation complete')
  console.log(`     - Order ID: ${orderId}`)
  console.log(`     - Total amount: ${order.totalAmount.toLocaleString()} KRW`)

  // In production, save to database
  // await db.orders.insert(order)

  // In production, deduct inventory
  // await db.inventory.update({ productId }, { $inc: { stock: -quantity } })

  ctx.order = order
}
