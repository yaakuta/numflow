/**
 * Step 300: Create User
 *
 * Create user object with normalized data.
 */

module.exports = async (ctx, req, res) => {
  console.log('ðŸ”¹ Step 300: Create user')

  // v0.2.0: Read directly from ctx
  const { normalizedData } = ctx

  // Generate user ID (in production, generated by DB)
  const userId = Math.random().toString(36).substring(7)

  // Create user object
  const user = {
    id: userId,
    ...normalizedData,
    createdAt: new Date().toISOString(),
    status: 'active',
  }

  console.log('  âœ… User creation complete:', user)

  // In production, save to DB
  // await db.users.insert(user)

  // v0.2.0: Store directly in ctx
  ctx.user = user
  ctx.userId = userId

  // Done! Automatically proceed to next step
}
